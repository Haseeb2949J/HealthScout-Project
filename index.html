<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthScout AI - Community Health Monitoring</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <style>
        /* General Resets and Body Styles */
        :root {
            --green-600: #16a34a;
            --green-700: #15803d;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
            --red-500: #ef4444;
            --red-600: #dc2626;
            --blue-500: #3b82f6;
            --yellow-50: '#fefce8';
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        .container {
            width: 100%;
            max-width: 1280px;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }
        
        /* Fullscreen Loader */
        .loader-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(255, 255, 255, 0.9);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 1rem;
        }
        .loader-text {
            font-weight: 500;
            color: var(--gray-600);
        }

        /* Login Page */
        .login-page {
            position: fixed;
            inset: 0;
            background-color: var(--gray-100);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-box {
            width: 100%;
            max-width: 448px;
            padding: 2rem;
            background-color: var(--white);
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        .login-title {
            text-align: center;
            margin-bottom: 2rem;
        }
        .login-title h1 {
            font-size: 1.875rem;
            font-weight: 800;
            color: var(--green-600);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .login-title h2 {
            font-size: 1.25rem;
            color: var(--gray-600);
            margin-top: 0.5rem;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-800);
        }
        .form-group input {
            width: 100%;
            padding: 0.75rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--white);
            background-color: var(--green-600);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .btn:hover {
            background-color: var(--green-700);
        }
        .btn:disabled {
            background-color: var(--gray-500);
            cursor: not-allowed;
        }
        .btn-danger {
            background-color: var(--red-500);
        }
        .btn-danger:hover {
            background-color: var(--red-600);
        }

        /* Header */
        .header {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 40;
        }
        .header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--green-600);
            text-decoration: none;
       C


        /* Hero Section */
        .hero-bg {
            padding: 6rem 0;
            color: var(--white);
            text-align: center;
            background-image: linear-gradient(to right, rgba(21, 128, 61, 0.85), rgba(88, 28, 135, 0.85)), url('https://placehold.co/1920x1080/cccccc/ffffff?text=Community+Area');
            background-size: cover;
            background-position: center;
        }
        .hero-bg h2 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }
        .hero-bg p {
            font-size: 1.25rem;
            max-width: 48rem;
            margin: 0 auto 2rem;
            color: #d1fae5;
        }
        .hero-bg a {
            background-color: var(--white);
            color: var(--green-600);
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 700;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
        }
        .hero-bg a:hover {
            transform: scale(1.05);
            background-color: #f3f4f6;
        }

        /* Sections & Cards */
        .section {
            padding: 5rem 0;
        }
        .section-title {
            text-align: center;
            margin-bottom: 4rem;
        }
        .section-title h3 {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--gray-900);
        }
        .section-title p {
            font-size: 1.125rem;
            color: var(--gray-600);
            margin-top: 0.75rem;
        }
        .features-grid {
            display: grid;
            gap: 2.5rem;
        }
        .feature-card {
            background-color: var(--white);
            padding: 2rem;
            text-align: center;
            border-radius: 0.75rem;
            border: 1px solid #f3f4f6;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-0.5rem);
        }
        .feature-card .icon-wrapper {
            height: 4rem;
            width: 4rem;
            margin: 0 auto 1.5rem;
            border-radius: 50%;
            background-color: #dcfce7;
            color: var(--green-600);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .feature-card h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        /* Dashboard */
        .dashboard {
            background-color: var(--gray-100);
        }
        .info-bar {
            background-color: var(--white);
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1);
            padding: 1rem;
            margin-bottom: 2rem;
            max-width: 56rem;
            margin-left: auto;
            margin-right: auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            gap: 1rem;
        }
        .location-search-container {
            position: relative;
            flex-grow: 1;
        }
        .location-search-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .location-search-wrapper input {
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            flex-grow: 1;
        }
         .location-search-wrapper button {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: var(--white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
         }
         .location-search-wrapper button:hover {
            background-color: var(--gray-100);
         }
        #autocomplete-list {
            position: absolute;
            background-color: var(--white);
            border: 1px solid #d1d5db;
            border-top: none;
            border-radius: 0 0 0.375rem 0.375rem;
            width: 100%;
            max-height: 150px;
            overflow-y: auto;
            z-index: 10;
        }
        .autocomplete-item {
            padding: 0.75rem;
            cursor: pointer;
        }
        .autocomplete-item:hover {
            background-color: var(--gray-100);
        }
        .info-bar-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .info-bar-item .lucide {
            color: var(--gray-500);
        }
        .info-bar-item span:first-of-type {
            font-weight: 500;
        }
        .dashboard-grid {
            display: grid;
            gap: 2rem;
        }
        .dashboard-card {
            background-color: var(--white);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        .dashboard-card h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .map-container {
            height: 24rem;
            background-color: var(--gray-100);
            border-radius: 0.5rem;
        }
        .map-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0.5rem;
        }
        .report-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            border-left-width: 4px;
        }
        .report-item.low-risk { background-color: #f0fdf4; border-color: #4ade80; }
        .report-item.medium-risk { background-color: #fefce8; border-color: #facc15; }
        .report-item.high-risk { background-color: #fef2f2; border-color: #f87171; }
        .report-item p { font-size: 0.875rem; }
        .report-item p:first-child { font-weight: 600; }
        .report-item .status { font-weight: 700; font-size: 0.875rem; }
        .report-item.low-risk .status { color: #16a34a; }
        .report-item.medium-risk .status { color: #ca8a04; }
        .report-item.high-risk .status { color: #dc2626; }
        .analyze-btn {
            background: none;
            border: none;
            font-weight: 700;
            font-size: 0.875rem;
            cursor: pointer;
            color: #ca8a04;
        }
        .analyze-btn.high-risk { color: #dc2626; }

        @keyframes fadeInHighlight {
            0% { opacity: 0; transform: translateY(-10px); background-color: var(--yellow-50); }
            50% { opacity: 1; transform: translateY(0); background-color: var(--yellow-50);}
            100% { }
        }
        .report-item.new {
            animation: fadeInHighlight 2s ease-out;
        }

        /* Environment Card */
        .environment-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        .env-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .env-item .lucide {
            color: var(--gray-500);
        }
        .env-item-value {
            font-size: 1.25rem;
            font-weight: 700;
        }
        .env-item-label {
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        .aqi-value {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .aqi-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
         .delete-btn {
    width: auto;
    padding: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.5rem;
}
    .delete-btn i {
    width: 18px;
    height: 18px;
}




        /* Footer */
        .footer {
            background-color: var(--gray-900);
            color: var(--white);
            padding: 3rem 0;
            text-align: center;
        }
        .footer p { color: #9ca3af; }
        .footer .logo { justify-content: center; color: var(--white); font-size: 1.25rem; }
        .footer .copy { font-size: 0.875rem; margin-top: 1.5rem; color: #6b7280; }

        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 50;
        }
        .modal-content {
            background-color: var(--white);
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            width: 100%;
            max-width: 42rem;
        }
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 { font-size: 1.5rem; font-weight: 700; }
        .modal-header button { background: none; border: none; cursor: pointer; color: var(--gray-500); }
        .modal-body {
            padding: 1.5rem;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        /* Profile Modal Specifics */
        .profile-modal-body {
            text-align: center;
        }
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--gray-200);
            color: var(--gray-600);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
        }
        .profile-email {
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 0.25rem;
        }
        .profile-stats {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray-200);
        }
        .profile-stats p {
            font-size: 1rem;
            color: var(--gray-600);
        }
        .profile-stats span {
            font-weight: 700;
            color: var(--gray-900);
        }

        /* Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Styles */
            /* ---------- Mobile hamburger button ---------- */
.mobile-menu-btn {
  background: none;
  border: none;
  font-size: 1.25rem;
  color: var(--gray-800);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.25rem;
}

/* ---------- Mobile nav (hidden by default) ---------- */
.main-nav {
  display: none;                 /* hidden on small screens */
  position: absolute;
  top: 100%;
  right: 1.5rem;
  background: var(--white);
  border-radius: 0.5rem;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  padding: 0.75rem;
  flex-direction: column;
  gap: 0.5rem;
  z-index: 45;
  min-width: 210px;
}

/* Buttons/links in mobile menu full width for easier tapping */
.main-nav a,
.main-nav button {
  display: block;
  width: 100%;
  text-align: left;
  padding: 0.5rem 0.75rem;
  border-radius: 0.375rem;
  background: none;
  color: var(--gray-600);
  text-decoration: none;
  font-weight: 600;
  border: none;
}

/* Hover / focus styles */
.main-nav a:hover,
.main-nav button:hover {
  background: var(--gray-50);
  color: var(--green-600);
}

/* When menu is toggled open */
.main-nav.show {
  display: flex;
}
        @media (min-width: 768px) {
            .main-nav {
        display: flex;
        align-items: center;
        gap: 2rem;
    }
    .features-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}


/* ---------- Desktop: restore horizontal nav ---------- */
@media (min-width: 768px) {
  .mobile-menu-btn { display: none; } /* hide burger on desktop */

  .main-nav {
    display: flex !important;  /* horizontal on desktop */
    position: static;
    flex-direction: row;
    gap: 2rem;
    background: transparent;
    box-shadow: none;
    padding: 0;
    align-items: center;
    min-width: 0;
  }

  .main-nav a,
  .main-nav button {
    width: auto;
    padding: 0;
    text-align: center;
    color: var(--gray-600);
    background: none;
  }
}
            .features-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .dashboard-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .dashboard-grid .map-card {
                grid-column: span 3 / span 3;
            }
             .dashboard-grid .env-card {
                grid-column: span 1 / span 1;
            }
            .dashboard-grid .reports-card {
                 grid-column: span 2 / span 2;
            }
            .dashboard-grid .advisory-card, .dashboard-grid .summary-card {
                grid-column: span 3 / span 3;
            }
            .hero-bg h2 {
                font-size: 3.75rem;
            }
        }
    </style>
</head>
<body>
    <div id="loader" class="loader-overlay hidden">
        <div class="spinner" style="width: 48px; height: 48px;"></div>
        <p class="loader-text">Loading...</p>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="login-page">
        <div class="login-box">
            <div class="login-title">
                <h1>
                    <i data-lucide="shield-check"></i>
                    HealthScout AI
                </h1>
                <h2 id="auth-title">Login to access the dashboard</h2>
            </div>
            <form id="auth-form">
                <div class="form-group">
                    <label for="auth-email">Email Address</label>
                    <input id="auth-email" name="email" type="email" autocomplete="email" required placeholder="you@example.com">
                </div>
                <div class="form-group">
                    <label for="auth-password">Password</label>
                    <input id="auth-password" name="password" type="password" autocomplete="current-password" required placeholder="••••••••">
                </div>
                <div class="form-group hidden" id="confirm-password-group">
                    <label for="auth-confirm-password">Confirm Password</label>
                    <input id="auth-confirm-password" name="confirm-password" type="password" placeholder="••••••••">
                </div>
                <p id="auth-error" style="color: red; font-size: 0.875rem; text-align: center; margin-bottom: 1rem;"></p>
                <div>
                    <button type="submit" id="auth-btn" class="btn">
                        <span>Sign In</span>
                    </button>
                </div>
            </form>
            <p style="text-align: center; margin-top: 1.5rem; font-size: 0.875rem;">
                <span id="auth-prompt-text">Don't have an account?</span>
                <a href="#" id="auth-toggle-link" style="color: var(--green-600); font-weight: 600;">Sign Up</a>
            </p>
        </div>
    </div>

    <!-- Main Content (Initially Hidden) -->
    <div id="main-content" class="hidden">
        <header class="header">
            <div class="container">
                <a href="#" class="logo">
                    <i data-lucide="shield-check"></i>
                    <span>HealthScout AI</span>
                </a>
                 <!-- Hamburger menu button -->
    <button id="menu-toggle" class="mobile-menu-btn" aria-label="Open menu" aria-expanded="false">
      <i data-lucide="menu"></i>
    </button>
                <nav class="main-nav">
                    <a href="#how-it-works">How It Works</a>
                    <a href="#dashboard">Live Dashboard</a>
                    <a href="#mission">Our Mission</a>
                    <div class="nav-buttons">
                        <button id="report-issue-btn">Report an Issue</button>
                        <button id="profile-btn" title="View Profile">
                            <i data-lucide="user-circle-2"></i>
                        </button>
                    </div>
                </nav>
            </div>
        </header>

        <main>
            <section class="hero-bg">
                <div class="container">
                    <h2>Identify Public Health Risks With AI.</h2>
                    <p>Use your phone to report community health hazards. Help create a safer environment for everyone.</p>
                    <a href="#dashboard">View Live Health Dashboard</a>
                </div>
            </section>

            <section id="how-it-works" class="section">
                <div class="container">
                    <div class="section-title">
                        <h3>Three Steps to a Healthier Community</h3>
                        <p>Spot and report issues in under a minute.</p>
                    </div>
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="icon-wrapper"><i data-lucide="camera"></i></div>
                            <h4>1. Snap a Photo</h4>
                            <p>Photograph potential health risks like stagnant water or improper waste disposal.</p>
                        </div>
                        <div class="feature-card">
                            <div class="icon-wrapper"><i data-lucide="cpu"></i></div>
                            <h4>2. AI Analysis</h4>
                            <p>Our AI analyzes the image to identify risks like mosquito breeding grounds or sanitation hazards.</p>
                        </div>
                        <div class="feature-card">
                            <div class="icon-wrapper"><i data-lucide="shield-alert"></i></div>
                            <h4>3. Alert the Community</h4>
                            <p>Your anonymous report is added to a live health map, helping officials and neighbors stay informed.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="dashboard" class="section dashboard">
                <div class="container">
                    <div class="section-title">
                        <h3>Live Health Dashboard</h3>
                        <p>Real-time public health data reported by the community.</p>
                    </div>
                     <div class="info-bar">
                        <div class="location-search-container">
                            <div class="location-search-wrapper">
                                <i data-lucide="map-pin" style="color: var(--red-500)"></i>
                                <input type="text" id="location-search-input" placeholder="Enter Pincode or City Name..." value="Dibiyapur, Uttar Pradesh" autocomplete="off">
                                <button id="location-search-btn" title="Search"><i data-lucide="search"></i></button>
                                <button id="use-my-location-btn" title="Use My Location"><i data-lucide="navigation"></i></button>
                            </div>
                            <div id="autocomplete-list" class="hidden"></div>
                        </div>
                        <div class="info-bar-item">
                             <i data-lucide="clock" style="color: var(--blue-500)"></i>
                            <span>Current Time:</span>
                            <span id="time-display">4:05 PM IST</span>
                        </div>
                    </div>
                    <div class="dashboard-grid">
                        <div class="dashboard-card map-card">
                            <h4>Community Health Risk Map</h4>
                            <div class="map-container">
                                <iframe id="google-map-iframe"
                                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d28615.42173115454!2d79.6928885192661!3d26.621445700295556!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x399bb10826c78161%3A0x673995166432f559!2sDibiyapur%2C%20Uttar%20Pradesh%20206244%2C%20India!5e0!3m2!1sen!2sus!4v1726320054321!5m2!1sen!2sus" 
                                    allowfullscreen="" 
                                    loading="lazy" 
                                    referrerpolicy="no-referrer-when-downgrade">
                                </iframe>
                            </div>
                        </div>

                        <div class="dashboard-card env-card">
                             <h4>Live Environmental & Safety Data</h4>
                             <div id="environment-data-container" class="environment-grid">
                                <!-- Data will be injected here by JS -->
                             </div>
                        </div>

                        <div class="dashboard-card reports-card">
                            <h4>Recent Local Reports</h4>
                            <div id="recent-reports-container">
                                <div id="reports-loader" class="hidden" style="display: flex; justify-content: center; padding: 2rem;">
                                    <div class="spinner" style="width: 32px; height: 32px;"></div>
                                </div>
                                <p id="no-reports-message" style="color: var(--gray-500); text-align: center; padding: 2rem 0;">No reports submitted for this area yet. Be the first!</p>
                            </div>
                        </div>
                        
                        <div class="dashboard-card summary-card">
                            <h4>✨ AI Summary of Local Health</h4>
                            <p style="margin-bottom: 1rem; font-size: 0.875rem;">Get a quick overview of the current health situation in the selected area based on all recent reports.</p>
                            <button id="get-summary-btn" class="btn" style="width: auto;">Generate Summary</button>
                            <div id="summary-container" style="margin-top: 1rem;"></div>
                        </div>

                        <div class="dashboard-card advisory-card">
                            <h4>✨ AI-Powered Health Advisory</h4>
                            <p style="margin-bottom: 1rem; font-size: 0.875rem;">Get a personalized health advisory for the selected region based on current data.</p>
                            <button id="get-safety-tips-btn" class="btn" style="width: auto;">Generate Advisory</button>
                            <div id="safety-tips-container" style="margin-top: 1rem;"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="mission" class="section" style="background-color: var(--white);">
                <div class="container" style="text-align: center;">
                    <h2 style="font-size: 2.25rem; font-weight: 800;">Help Build a Healthier Community</h2>
                    <p style="font-size: 1.125rem; max-width: 48rem; margin: 1rem auto 0;">
                        By submitting a single report, you're not just highlighting an issue. You're contributing to a global database that can predict health risks, alert communities, and guide public health officials.
                    </p>
                </div>
            </section>
        </main>
        
        <!-- AI Analysis Modal -->
        <div id="ai-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>✨ AI Analysis</h3>
                    <button class="close-modal-btn" data-modal-id="ai-modal"><i data-lucide="x"></i></button>
                </div>
                <div id="modal-content-body" class="modal-body"></div>
            </div>
        </div>
        
        <!-- Report Issue Modal -->
        <div id="report-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 32rem;">
                <div class="modal-header">
                    <h3>Report a Health Issue</h3>
                    <button class="close-modal-btn" data-modal-id="report-modal"><i data-lucide="x"></i></button>
                </div>
                <form id="report-form" class="modal-body" style="display: flex; flex-direction: column; gap: 1rem;">
                     <div class="form-group" style="margin: 0;">
                        <label for="issue-type">Type of Issue</label>
                        <select id="issue-type" name="issue-type" class="form-group input" style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; background-color: white;">
                            <option>Stagnant Water</option>
                            <option>Improper Waste Disposal</option>
                            <option>Poor Sanitation</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin: 0;">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" rows="3" class="form-group input" style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem;" placeholder="Describe the issue you observed..."></textarea>
                    </div>
                     <div class="form-group" style="margin: 0;">
                        <label for="photo">✨ Upload Photo</label>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="file" name="photo" id="photo" accept="image/*" />
                             <div id="photo-spinner" class="spinner hidden"></div>
                        </div>
                        <p style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem;">AI will help fill the form based on your photo.</p>
                    </div>
                    <p id="report-error" style="color: red; font-size: 0.875rem; text-align: center; min-height: 1.25rem;"></p>
                    <div style="text-align: right;">
                         <button type="submit" class="btn" style="width: auto;">Submit Report</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Profile Modal -->
        <div id="profile-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 28rem;">
                <div class="modal-header">
                    <h3>Your Profile</h3>
                    <button class="close-modal-btn" data-modal-id="profile-modal"><i data-lucide="x"></i></button>
                </div>
                <div class="modal-body profile-modal-body">
                    <div class="profile-avatar">
                        <i data-lucide="user" style="width: 48px; height: 48px;"></i>
                    </div>
                    <p id="profile-email-display" class="profile-email">you@example.com</p>
                    <p style="color: var(--gray-500); font-size: 0.875rem;">Community Contributor</p>
                    
                    <div class="profile-stats">
                        <p>Reports Submitted: <span id="reports-submitted-count">0</span></p>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                         <button id="logout-btn" class="btn btn-danger" style="width: 100%;">Logout</button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <div class="container">
                 <a href="#" class="logo">
                    <i data-lucide="shield-check"></i>
                    <span>HealthScout AI</span>
                </a>
                <p>Making public health data accessible to everyone.</p>
                <p class="copy">&copy; 2025 HealthScout AI Project. A GDG Submission.</p>
            </div>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            onAuthStateChanged, 
            signOut 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            where, 
            onSnapshot, 
            serverTimestamp,
            deleteDoc,
            doc,
            orderBy 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        window.addEventListener('load', (event) => {
            lucide.createIcons();
            
            // --- Firebase & API Key Setup ---
            // #######################################################################
            // ##                                                                   ##
            // ##  ACTION REQUIRED: COMPLETE THESE TWO SETUP STEPS                  ##
            // ##                                                                   ##
            // #######################################################################

            // STEP 1: Paste your Firebase project configuration object here.
            // Find this in your Firebase project settings.
            const firebaseConfig = {
                apiKey: "AIzaSyCweBoUJg4BIChGw5UQe7zjkOXYAfsF2mQ",
                authDomain: "healthscoutai-a6a1a.firebaseapp.com",
                projectId: "healthscoutai-a6a1a",
                storageBucket: "healthscoutai-a6a1a.firebasestorage.app",
                messagingSenderId: "826645153981",
                appId: "1:826645153981:web:6761ec5da1060b62cf8fd4",
                measurementId: "G-JXM98NQE47"
            };

            // ------------- Mobile menu toggle -------------
const menuToggleBtn = document.getElementById('menu-toggle');
const mainNav = document.querySelector('.main-nav');

if (menuToggleBtn && mainNav) {
  // Toggle menu open/close
  menuToggleBtn.addEventListener('click', (ev) => {
    ev.stopPropagation();
    const isOpen = mainNav.classList.toggle('show');
    menuToggleBtn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
  });

  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    if (!mainNav.contains(e.target) && e.target !== menuToggleBtn) {
      mainNav.classList.remove('show');
      menuToggleBtn.setAttribute('aria-expanded', 'false');
    }
  });

  // Hide menu when a nav link/button is clicked
  mainNav.querySelectorAll('a, button').forEach(item => {
    item.addEventListener('click', () => {
      mainNav.classList.remove('show');
      menuToggleBtn.setAttribute('aria-expanded', 'false');
    });
  });

  // Reset on resize to desktop
  window.addEventListener('resize', () => {
    if (window.innerWidth >= 768) {
      mainNav.classList.remove('show');
      menuToggleBtn.setAttribute('aria-expanded', 'false');
    }
  });
}

            // --- Current Time Updater ---
function updateTime() {
    const now = new Date();
    const options = { 
        hour: 'numeric', 
        minute: 'numeric', 
        second: 'numeric',
        hour12: true, 
        timeZone: 'Asia/Kolkata' // IST timezone
    };
    document.getElementById('time-display').textContent = now.toLocaleString('en-IN', options) + " IST";
}

// Update immediately and then every second
updateTime();
setInterval(updateTime, 1000);

            // STEP 2: Paste your Google AI Gemini API key here.
            // Get a free key from Google AI Studio: https://aistudio.google.com/
            const GEMINI_API_KEY = "AIzaSyCKIA3z41kJpx4bzuILIw05O2RGS7xchiA"; // <--- PASTE YOUR GEMINI API KEY HERE


            // #######################################################################
            // ##                                                                   ##
            // ##  END OF REQUIRED SETUP                                            ##
            // ##                                                                   ##
            // #######################################################################


            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            const auth = getAuth(app);
            const db = getFirestore(app);


            // --- Element Declarations ---
            const loader = document.getElementById('loader');
            const loginPage = document.getElementById('login-page');
            const mainContent = document.getElementById('main-content');
            const authForm = document.getElementById('auth-form');
            const authEmailInput = document.getElementById('auth-email');
            const authPasswordInput = document.getElementById('auth-password');
            const confirmPasswordGroup = document.getElementById('confirm-password-group');
            const confirmPasswordInput = document.getElementById('auth-confirm-password');
            const authBtn = document.getElementById('auth-btn');
            const authTitle = document.getElementById('auth-title');
            const authToggleLink = document.getElementById('auth-toggle-link');
            const authPromptText = document.getElementById('auth-prompt-text');
            const authError = document.getElementById('auth-error');
            
            const reportModal = document.getElementById('report-modal');
            const aiModal = document.getElementById('ai-modal');
            const profileModal = document.getElementById('profile-modal');

            const reportIssueBtn = document.getElementById('report-issue-btn');
            const profileBtn = document.getElementById('profile-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const profileEmailDisplay = document.getElementById('profile-email-display');
            const reportsSubmittedCount = document.getElementById('reports-submitted-count');

            const reportForm = document.getElementById('report-form');
            const recentReportsContainer = document.getElementById('recent-reports-container');
            const noReportsMessage = document.getElementById('no-reports-message');
            const reportsLoader = document.getElementById('reports-loader');

            const locationSearchInput = document.getElementById('location-search-input');
            const locationSearchBtn = document.getElementById('location-search-btn');
            const useMyLocationBtn = document.getElementById('use-my-location-btn');
            const mapIframe = document.getElementById('google-map-iframe');
            const autocompleteList = document.getElementById('autocomplete-list');
            const environmentContainer = document.getElementById('environment-data-container');

            let isSignUp = false;
            let currentUser = null;
            let unsubscribeReports = null;

            // --- Auth UI Toggle ---
            authToggleLink.addEventListener('click', (e) => {
                e.preventDefault();
                isSignUp = !isSignUp;
                authError.textContent = '';
                if (isSignUp) {
                    authTitle.textContent = 'Create a New Account';
                    authBtn.querySelector('span').textContent = 'Sign Up';
                    authPromptText.textContent = 'Already have an account?';
                    authToggleLink.textContent = 'Sign In';
                    confirmPasswordGroup.classList.remove('hidden');
                    confirmPasswordInput.required = true;
                } else {
                    authTitle.textContent = 'Login to access the dashboard';
                    authBtn.querySelector('span').textContent = 'Sign In';
                    authPromptText.textContent = "Don't have an account?";
                    authToggleLink.textContent = 'Sign Up';
                    confirmPasswordGroup.classList.add('hidden');
                    confirmPasswordInput.required = false;
                }
            });

            // --- Firebase Auth Logic ---
             authForm.addEventListener('submit', (e) => {
                e.preventDefault();
                authError.textContent = '';
                const email = authEmailInput.value;
                const password = authPasswordInput.value;

                authBtn.disabled = true;
                authBtn.innerHTML = '<div class="spinner" style="margin: auto; border-left-color: white;"></div>';


                if (isSignUp) {
                    // Handle Sign Up
                    const confirmPassword = confirmPasswordInput.value;
                    if (password !== confirmPassword) {
                        authError.textContent = 'Passwords do not match.';
                        authBtn.disabled = false;
                        authBtn.innerHTML = '<span>Sign Up</span>';
                        return;
                    }
                    createUserWithEmailAndPassword(auth, email, password)
                        .catch(error => { 
                             console.error("Sign up error:", error.code);
                             if (error.code === 'auth/email-already-in-use') {
                                authError.textContent = 'An account with this email already exists.';
                             } else if (error.code === 'auth/weak-password') {
                                authError.textContent = 'Password should be at least 6 characters.';
                             }
                             else {
                                authError.textContent = 'Could not create account. Please try again.';
                             }
                        }).finally(() => {
                            if(!auth.currentUser || isSignUp) { 
                                authBtn.disabled = false;
                                authBtn.innerHTML = '<span>Sign Up</span>';
                            }
                        });
                } else {
                    // Handle Sign In
                    signInWithEmailAndPassword(auth, email, password)
                        .catch(error => {
                            console.error("Sign in error:", error.code);
                            authError.textContent = "Invalid password/email or account does not exist.";
                        }).finally(() => {
                            if(!auth.currentUser) {
                                authBtn.disabled = false;
                                authBtn.innerHTML = '<span>Sign In</span>';
                            }
                        });
                }
            });

            logoutBtn.addEventListener('click', () => {
                signOut(auth);
            });

            // --- Auth State Listener ---
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is signed in, show the main content immediately
                    currentUser = user;
                    profileEmailDisplay.textContent = user.email;
                    loginPage.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                    updateLocation('Dibiyapur, Uttar Pradesh');
                    
                    // Fetch reports in the background
                    fetchUserReports(user.uid);
                    
                    authBtn.disabled = false;
                    authBtn.innerHTML = `<span>${isSignUp ? 'Sign Up' : 'Sign In'}</span>`;

                } else {
                    // User is signed out
                    currentUser = null;
                    if (unsubscribeReports) {
                        unsubscribeReports();
                    }
                    mainContent.classList.add('hidden');
                    loginPage.classList.remove('hidden');
                    loader.classList.add('hidden');
                    recentReportsContainer.innerHTML = '';
                    noReportsMessage.classList.remove('hidden');
                    reportsSubmittedCount.textContent = 0;
                }
            });

            // --- Modal Handling ---
            reportIssueBtn.addEventListener('click', () => reportModal.classList.remove('hidden'));
            profileBtn.addEventListener('click', () => profileModal.classList.remove('hidden'));
            
            document.querySelectorAll('.close-modal-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const modalId = btn.dataset.modalId;
                    document.getElementById(modalId).classList.add('hidden');
                });
            });
            
            [aiModal, reportModal, profileModal].forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.classList.add('hidden');
                });
            });

            // --- Location & Environment Data Logic ---
            const cities = [
                "Mumbai, Maharashtra", "Delhi, Delhi", "Bengaluru, Karnataka", "Ahmedabad, Gujarat", "Hyderabad, Telangana",
                "Chennai, Tamil Nadu", "Kolkata, West Bengal", "Pune, Maharashtra", "Jaipur, Rajasthan", "Surat, Gujarat",
                "Lucknow, Uttar Pradesh", "Kanpur, Uttar Pradesh", "Nagpur, Maharashtra", "Indore, Madhya Pradesh", "Thane, Maharashtra",
                "Bhopal, Madhya Pradesh", "Visakhapatnam, Andhra Pradesh", "Patna, Bihar", "Vadodara, Gujarat", "Ghaziabad, Uttar Pradesh",
                "Ludhiana, Punjab", "Agra, Uttar Pradesh", "Nashik, Maharashtra", "Faridabad, Haryana", "Meerut, Uttar Pradesh", "Rajkot, Gujarat",
                "Varanasi, Uttar Pradesh", "Srinagar, Jammu and Kashmir", "Aurangabad, Maharashtra", "Dhanbad, Jharkhand", "Amritsar, Punjab",
                "Allahabad, Uttar Pradesh", "Ranchi, Jharkhand", "Howrah, West Bengal", "Coimbatore, Tamil Nadu", "Jabalpur, Madhya Pradesh",
                "Gwalior, Madhya Pradesh", "Vijayada, Andhra Pradesh", "Jodhpur, Rajasthan", "Madurai, Tamil Nadu", "Raipur, Chhattisgarh",
                "Kota, Rajasthan", "Guwahati, Assam", "Chandigarh, Chandigarh", "Solapur, Maharashtra", "Hubli-Dharwad, Karnataka", "Mysuru, Karnataka",
                "Tiruchirappalli, Tamil Nadu", "Bareilly, Uttar Pradesh", "Aligarh, Uttar Pradesh", "Tiruppur, Tamil Nadu", "Moradabad, Uttar Pradesh",
                "Jalandhar, Punjab", "Bhubaneswar, Odisha", "Salem, Tamil Nadu", "Warangal, Telangana", "Guntur, Andhra Pradesh", "Bhiwandi, Maharashtra",
                "Saharanpur, Uttar Pradesh", "Gorakhpur, Uttar Pradesh", "Bikaner, Rajasthan", "Amravati, Maharashtra", "Noida, Uttar Pradesh",
                "Jamshedpur, Jharkhand", "Bhilai, Chhattisgarh", "Cuttack, Odisha", "Firozabad, Uttar Pradesh", "Kochi, Kerala", "Nellore, Andhra Pradesh",
                "Dehradun, Uttarakhand", "Durgapur, West Bengal", "Asansol, West Bengal", "Rourkela, Odisha", "Nanded, Maharashtra", "Kolhapur, Maharashtra",
                "Ajmer, Rajasthan", "Akola, Maharashtra", "Gulbarga, Karnataka", "Jamnagar, Gujarat", "Ujjain, Madhya Pradesh", "Loni, Uttar Pradesh",
                "Siliguri, West Bengal", "Jhansi, Uttar Pradesh", "Ulhasnagar, Maharashtra", "Jammu, Jammu and Kashmir", "Sangli-Miraj & Kupwad, Maharashtra",
                "Mangaluru, Karnataka", "Erode, Tamil Nadu", "Belagavi, Karnataka", "Ambattur, Tamil Nadu", "Tirunelveli, Tamil Nadu", "Malegaon, Maharashtra",
                "Gaya, Bihar", "Jalgaon, Maharashtra", "Udaipur, Rajasthan", "Maheshtala, West Bengal", "Tirupati, Andhra Pradesh", "Dibiyapur, Uttar Pradesh"
            ];

            locationSearchInput.addEventListener('input', () => {
                const query = locationSearchInput.value.toLowerCase();
                autocompleteList.innerHTML = '';
                if(query.length < 2) {
                    autocompleteList.classList.add('hidden');
                    return;
                }
                const filteredCities = cities.filter(city => city.toLowerCase().startsWith(query)).slice(0, 5);
                
                if(filteredCities.length > 0) {
                    autocompleteList.classList.remove('hidden');
                    filteredCities.forEach(city => {
                        const item = document.createElement('div');
                        item.className = 'autocomplete-item';
                        item.textContent = city;
                        item.addEventListener('click', () => {
                            locationSearchInput.value = city;
                            autocompleteList.classList.add('hidden');
                            updateLocation(city);
                        });
                        autocompleteList.appendChild(item);
                    });
                } else {
                    autocompleteList.classList.add('hidden');
                }
            });

            document.addEventListener('click', (e) => {
                if(e.target !== locationSearchInput) {
                    autocompleteList.classList.add('hidden');
                }
            });

            const updateLocation = (query) => {
                const formattedQuery = query.split(',')[0];
                locationSearchInput.value = formattedQuery.charAt(0).toUpperCase() + formattedQuery.slice(1);
                const searchMapUrl = `https://maps.google.com/maps?q=${encodeURIComponent(query)}&t=&z=13&ie=UTF8&iwloc=&output=embed`;
                mapIframe.src = searchMapUrl;
                autocompleteList.classList.add('hidden');
                fetchAndDisplayEnvironmentalData(query);
            }
            
            function fetchAndDisplayEnvironmentalData(location) {
                // Mock data generation
                const temp = (location.length % 18) + 20; // 20-37°C
                const aqi = (location.length * 7 % 250) + 10; // 10-260
                const pollen = ['Low', 'Medium', 'High'][(location.length % 3)];
                const conditions = ['Sunny', 'Cloudy', 'Hazy', 'Light Rain'][(location.length % 4)];

                let aqiStatus, aqiColor;
                if (aqi <= 50) { aqiStatus = 'Good'; aqiColor = '#22c55e'; }
                else if (aqi <= 100) { aqiStatus = 'Moderate'; aqiColor = '#facc15'; }
                else if (aqi <= 150) { aqiStatus = 'Unhealthy (SG)'; aqiColor = '#f97316'; }
                else { aqiStatus = 'Unhealthy'; aqiColor = '#ef4444'; }
                
                environmentContainer.innerHTML = `
                    <div class="env-item">
                        <i data-lucide="thermometer"></i>
                        <div>
                            <div class="env-item-value">${temp}°C</div>
                            <div class="env-item-label">${conditions}</div>
                        </div>
                    </div>
                    <div class="env-item">
                        <i data-lucide="wind"></i>
                        <div>
                            <div class="env-item-value aqi-value">
                                <span class="aqi-dot" style="background-color: ${aqiColor};"></span>
                                ${aqi}
                            </div>
                            <div class="env-item-label">AQI (${aqiStatus})</div>
                        </div>
                    </div>
                    <div class="env-item">
                         <i data-lucide="leaf"></i>
                        <div>
                            <div class="env-item-value">${pollen}</div>
                            <div class="env-item-label">Pollen Count</div>
                        </div>
                    </div>
                `;
                lucide.createIcons();
            }


            locationSearchBtn.addEventListener('click', () => {
                const query = locationSearchInput.value;
                if (query) updateLocation(query);
            });
            
            locationSearchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const query = locationSearchInput.value;
                    if (query) updateLocation(query);
                }
            });

            useMyLocationBtn.addEventListener('click', () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            updateLocation(`${latitude},${longitude}`);
                            locationSearchInput.value = "Your Current Location";
                        },
                        (error) => {
                            alert(`Error getting location: ${error.message}`);
                        }
                    );
                } else {
                    alert('Geolocation is not supported by your browser.');
                }
            });


            // --- Report Submission & Firestore Logic ---
            const createReportElement = (report) => {
    let riskClass = 'medium-risk';
    let analyzeClass = '';
    if (report.issueType === 'Improper Waste Disposal' || report.issueType === 'Poor Sanitation') {
        riskClass = 'high-risk';
        analyzeClass = 'high-risk';
    }

    const reportEl = document.createElement('div');
    reportEl.className = `report-item ${riskClass}`;
    reportEl.innerHTML = `
        <div>
            <p>${report.location}</p>
            <p data-issue="${report.description}">${report.description}</p>
        </div>
        <div style="display:flex; gap:0.5rem;">
            <button class="analyze-btn ${analyzeClass}" 
                    data-location="${report.location}" 
                    data-issue="${report.description}">
                ✨ Analyze
            </button>
            <button class="delete-btn btn btn-danger" data-id="${report.id}" title="Delete Report">
    <i data-lucide="trash-2"></i>
</button>
        </div>
    `;

    // add listeners
    addAnalyzeListener(reportEl.querySelector('.analyze-btn'));
    addDeleteListener(reportEl.querySelector('.delete-btn'));

    return reportEl;
};

            const renderReports = (reports) => {
                reportsLoader.classList.add('hidden');
                recentReportsContainer.innerHTML = ''; // Clear existing reports
                if (reports.length === 0) {
                    noReportsMessage.classList.remove('hidden');
                } else {
                    noReportsMessage.classList.add('hidden');
                    reports.forEach(report => {
                        const reportEl = createReportElement(report);
                        recentReportsContainer.appendChild(reportEl);
                    });
                    lucide.createIcons();
                }
            };

            const fetchUserReports = (uid) => {
                return new Promise((resolve, reject) => {
                    reportsLoader.classList.remove('hidden');
                    noReportsMessage.classList.add('hidden');

                    if (unsubscribeReports) unsubscribeReports(); 
    
                    const reportsRef = collection(db, "reports");
                    const q = query(reportsRef, where("userId", "==", uid), orderBy("createdAt", "desc"));
    
                    unsubscribeReports = onSnapshot(q, (snapshot) => {
                        const reports = [];
                        snapshot.forEach((doc) => {
                            reports.push({ id: doc.id, ...doc.data() });
                        });
                        renderReports(reports);
                        reportsSubmittedCount.textContent = reports.length;
                        resolve(); // Resolve the promise once data is loaded
                    }, (error) => {
                        const errorMessage = 'Could not load reports. Please check your Firestore security rules or required indexes in the Firebase console.';
                        console.error(errorMessage, error);
                        reportsLoader.classList.add('hidden');
                        recentReportsContainer.innerHTML = `<p style="color: var(--red-600); text-align: center; padding: 2rem 0;">${errorMessage}</p>`;
                        reject(error); // Reject the promise on error
                    });
                });
            }

            reportForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                if (!currentUser) { return; }
                
                const submitButton = e.target.querySelector('button[type="submit"]');
                const issueType = document.getElementById('issue-type').value;
                const description = document.getElementById('description').value;
                const location = locationSearchInput.value.split(',')[0];
                const reportError = document.getElementById('report-error');
                reportError.textContent = '';

                if (!description.trim()) {
                    reportError.textContent = 'Please provide a description for the issue.';
                    return;
                }
                
                // --- Start: New Instant UI Update Logic ---
                submitButton.disabled = true;
                submitButton.innerHTML = '<div class="spinner" style="margin: auto; border-left-color: white;"></div>';

                // Immediately close the modal and reset the form
                reportModal.classList.add('hidden');
                e.target.reset();

                // Then, try to save to the database in the background
                addDoc(collection(db, "reports"), {
                    userId: currentUser.uid,
                    issueType,
                    description,
                    location,
                    createdAt: serverTimestamp()
                })
                .catch(error => {
                    console.error("Error adding document: ", error);
                    alert("Submission failed. Your report was not saved. Please check your Firestore rules or internet connection.");
                })
                .finally(() => {
                    // Re-enable the button regardless of the outcome.
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<span>Submit Report</span>';
                });
                // --- End: New Instant UI Update Logic ---
            });


            // --- Gemini API ---
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;
            
            const modalContentBody = document.getElementById('modal-content-body');
            
            async function callGemini(payload, targetElement) {
                if (!GEMINI_API_KEY) {
                    const errorMsg = "ACTION REQUIRED: Your Gemini API Key is missing. The AI features cannot work until you get a free key from Google AI Studio and paste it into the `GEMINI_API_KEY` constant in the `index.html` file.";
                    console.error(errorMsg);
                    if (targetElement) {
                        targetElement.innerHTML = `<p style="color: #dc2626;">${errorMsg}</p>`;
                    }
                    alert(errorMsg);
                    return null;
                }
                
                if(targetElement) {
                   targetElement.innerHTML = '<div style="display: flex; justify-content: center; padding: 2rem;"><div class="spinner" style="width: 36px; height: 36px;"></div></div>';
                }
                
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) {
                        return text;
                    } else {
                        throw new Error("No content received from API.");
                    }
                } catch (error) {
                    console.error("Error calling Gemini API:", error);
                    const errorMsg = "AI analysis failed. Please check your Gemini API key and ensure the 'Generative Language API' is enabled in your Google Cloud project.";
                     if (targetElement) {
                        targetElement.innerHTML = `<p style="color: #dc2626;">${errorMsg}</p>`;
                    }
                    alert(errorMsg);
                    return null;
                }
            }
            
            const analyzeButtonHandler = async (button) => {
                const location = button.dataset.location;
                const issue = button.dataset.issue;
                const prompt = `A public health issue has been reported in ${location}: "${issue}". Act as a public health expert for a community member in India. Explain in simple terms: 1. Potential health risks. 2. Potential causes. 3. Simple, practical steps for mitigation. Format the response using HTML with headings (<h4>) and paragraphs (<p>).`;
                
                aiModal.classList.remove('hidden');
                const payload = { contents: [{ parts: [{ text: prompt }] }] };
                const resultText = await callGemini(payload, modalContentBody);
                if(resultText) {
                    modalContentBody.innerHTML = resultText.replace(/\n/g, '<br>');
                }
            };

            function addAnalyzeListener(button) {
                button.addEventListener('click', () => analyzeButtonHandler(button));
            }
            
            document.querySelectorAll('.analyze-btn').forEach(addAnalyzeListener);
            // --- NEW DELETE LISTENER FUNCTION ---
function addDeleteListener(button) {
    button.addEventListener('click', async () => {
        const reportId = button.dataset.id;
        if (confirm("Are you sure you want to delete this report?")) {
            try {
                await deleteDoc(doc(db, "reports", reportId));
                console.log("Report deleted:", reportId);
            } catch (error) {
                console.error("Error deleting report:", error);
                alert("Failed to delete report. Please try again.");
            }
        }
    });
}
            
            // --- AI Summary Feature ---
            const getSummaryBtn = document.getElementById('get-summary-btn');
            const summaryContainer = document.getElementById('summary-container');

            getSummaryBtn.addEventListener('click', async (e) => {
                const reportElements = document.querySelectorAll('#recent-reports-container .report-item p[data-issue]');
                let reportsText = Array.from(reportElements).map(el => el.textContent);
                const location = locationSearchInput.value.split(',')[0];


                if (reportsText.length === 0) {
                    summaryContainer.innerHTML = "<p>No reports available to summarize for this area.</p>";
                    return;
                }

                const prompt = `Here is a list of recent health reports from ${location}, India: "${reportsText.join('", "')}". Act as a public health analyst and provide a brief, 2-3 bullet point summary of the main health concerns for the area right now. The tone should be informative and clear for a community member. Format the response as an HTML unordered list (\`<ul>\`).`;

                e.target.disabled = true;
                e.target.textContent = 'Generating...';

                const payload = { contents: [{ parts: [{ text: prompt }] }] };
                const resultText = await callGemini(payload, summaryContainer);

                if (resultText) {
                     summaryContainer.innerHTML = resultText.replace(/\n/g, '<br>');
                }

                e.target.disabled = false;
                e.target.textContent = 'Generate Summary';
            });


            document.getElementById('get-safety-tips-btn').addEventListener('click', async (e) => {
                const safetyTipsContainer = document.getElementById('safety-tips-container');
                const location = locationSearchInput.value.split(',')[0];
                const prompt = `Based on reports for the ${location}, India region (stagnant water, waste disposal), generate a practical public health advisory. Include tips on preventing mosquito-borne illnesses and maintaining sanitation. Tone should be helpful. Format as HTML with a main heading (<h4>) and an unordered list (<ul>).`;
                e.target.disabled = true;
                e.target.textContent = 'Generating...';
                
                const payload = { contents: [{ parts: [{ text: prompt }] }] };
                const resultText = await callGemini(payload, safetyTipsContainer);

                if (resultText) {
                    const cleanText = resultText
                     .replace(/```html/gi, "")
                     .replace(/```/g, "")
                     .trim();
                    
                    safetyTipsContainer.innerHTML = `<div class="ai-output">${cleanText}</div>`;
                }

                e.target.disabled = false;
                e.target.textContent = 'Generate Advisory';
            });

            // --- Gemini Image Analysis Feature ---
            const photoInput = document.getElementById('photo');
            const photoSpinner = document.getElementById('photo-spinner');
            const issueTypeSelect = document.getElementById('issue-type');
            const descriptionTextarea = document.getElementById('description');

            photoInput.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                photoSpinner.classList.remove('hidden');

                try {
                    const base64ImageData = await fileToBase64(file);
                    const cleanBase64 = base64ImageData.split(',')[1];
                    
                    const prompt = `Analyze this image of a public health hazard. Identify the issue type from these options: 'Stagnant Water', 'Improper Waste Disposal', 'Poor Sanitation', 'Other'. Write a one-sentence description. Respond with a clean JSON object like: { "issueType": "Improper Waste Disposal", "description": "A pile of garbage is on the roadside." }`;
                    
                    const payload = { contents: [{ parts: [{ text: prompt }, { inlineData: { mimeType: file.type, data: cleanBase64 } }] }] };
                    const responseText = await callGemini(payload, null);

                    if (!responseText) {
                        throw new Error("No content received from API after handling missing key.");
                    }

                    const cleanJsonText = responseText.replace(/```json/g, '').replace(/```/g, '').trim();
                    try {
                        const parsedData = JSON.parse(cleanJsonText);
                        if (parsedData.issueType) issueTypeSelect.value = parsedData.issueType;
                        if (parsedData.description) descriptionTextarea.value = parsedData.description;
                    } catch (jsonError) {
                        console.error("Failed to parse JSON:", jsonError, "Response was:", cleanJsonText);
                        descriptionTextarea.value = "AI analysis couldn't determine the issue.";
                    }

                } catch (error) {
                    console.error("Error during AI photo analysis:", error);
                } finally {
                    photoSpinner.classList.add('hidden');
                }
            });

            function fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = error => reject(error);
                });
            }
        });
    </script>

</body>
</html>





